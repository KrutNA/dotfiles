#+PROPERTY: header-args:emacs-lisp :tangle "init.el"
#+AUTHOR: Krutko Nikita / KrutNA

In the first, ~init.el~ is autogenerated file, added to git for first inital start, edit only this ~readme.org~ file.

* init

Some inital configurations. 

** package

Addition of [[https://melpa.org/][MELPA]] archive for most of cool packages.

#+BEGIN_SRC emacs-lisp
  (require 'package)

  (add-to-list 'package-archives
	       '("melpa" . "https://melpa.org/packages/") t)
  (package-initialize)

#+END_SRC

** use-package

If ~use-package~ is not installed - install it.

The ~use-package~ macro allows beutiful customization and lazy loading of packages.

#+BEGIN_SRC emacs-lisp
  (unless (boundp 'use-package-version)
    (package-install 'use-package))

  (require 'use-package)
#+END_SRC

** setq

Some useful variables

*** XDG Base Directory paths

Setting up variables for XDG Base Directory specification.

#+BEGIN_SRC emacs-lisp
  (setq xdg-data-home                     "~/.local/share"
	xdg-config-home                   "~/.config"
	xdg-cache-home                    "~/.cache"
	xdg-download-dir                  "~/downloads")
#+END_SRC

*** Files 

File paths for this file and custom (custom is unused but it always created).

#+BEGIN_SRC emacs-lisp
  (setq custom-file                       (concat user-emacs-directory "custom.el")
	config-org-file                   (concat user-emacs-directory "readme.org")
	backup-directory-alist            `(("." . ,(concat user-emacs-directory "backups"))))
#+END_SRC

*** Variables

Variables for later using.

#+BEGIN_SRC emacs-lisp
  (setq local-confs/font-height           105             ; 10 = 1pt
	local-confs/tool-bar              -1              ; -1 for desabling
	local-confs/column-num            t               ; number of current column
	local-confs/line-num              t               ; number of current line

	;; programming
	electric-pair-mode                t               ; double parenthesis
	local-confs/paren-mode            t               ; show matching pars
	show-paren-delay                  0               ; delay to showing

	;; which-key
	local-confs/which-key-delay       0               ; delay to which-key after keypress 
	local-confs/which-key-s-delay     0.05            ; delay to rerender

	;; path to `tree-sitter` binaries
	local-confs/tree-sitter-bins      (concat xdg-data-home "/tree-sitter/bin")
	)
#+END_SRC

*** PATH

Emacs PATH env update

#+BEGIN_SRC emacs-lisp
  (setenv "PATH"
	  (concat xdg-data-home   "/cargo/bin"    ":"
		  xdg-data-home   "/bin"          ":"
		  (getenv "PATH")))

#+END_SRC


** Keybinds

Main keybinds not related to packages or related to created fuunctions

*** reverse-im

Makes available to use russian input method for hotkeys.

Somthing like on QUERTY ~M-Ñ‡~ will be translated to ~M-x~, very usefull.

Doen't work with some packages, like ~mu4e~.

#+BEGIN_SRC emacs-lisp
  (use-package reverse-im
    :ensure t
    :custom
    (reverse-im-input-methods '("russian-computer"))
    :config
    (reverse-im-mode t))
#+END_SRC


* view

Configuration of view, most of all UI.

** theme

Select theme and make it autoload on frame initialization because of bug with some themes which breaks with ~emacsclient~

#+BEGIN_SRC emacs-lisp
  (use-package spacemacs-theme
    :ensure t :defer t
    :hook (after-init . load-spacemacs-theme)
    :init
    (defun load-spacemacs-theme ()
      "Load spacemacs dark theme"
      (load-theme 'spacemacs-dark t)))
#+END_SRC

** on start

Configuraion on the emacs/emacsserver start

#+BEGIN_SRC emacs-lisp
  (tool-bar-mode                          local-confs/tool-bar)
  (column-number-mode                     local-confs/column-num)
  (line-number-mode                       local-confs/line-num)

  (set-face-attribute 'default nil :height local-confs/font-height)
#+END_SRC

** COMMENT after-init
#+BEGIN_SRC emacs-lisp
  (setq local-confs/font-height 105)

  (defun configure-emacsclient-buffer-on-load ()
    ""
    ())

  (add-hook 'after-init-hook 'configure-emacsclient-buffer-on-load)
#+END_SRC

** helm

Configuration of helm.

#+BEGIN_SRC emacs-lisp
  (use-package helm
    :ensure t
    :bind (:map helm-command-map
	   ("C-c h" . helm-execute-persistent-action)))
#+END_SRC

** which-key

Shows available keys on keypress

#+BEGIN_SRC emacs-lisp
  (use-package which-key
    :ensure t
    :custom
    (which-key-idle-delay 0)
    (which-key-idle-secondary-delay 0.05)
    :config
    (which-key-mode))
#+END_SRC


* org-mode
#+BEGIN_SRC emacs-lisp
  (use-package org
    :after ox-latex
    :hook (org-mode . turn-on-org-cdlatex)
    :config
    (setq org-src-fontify-natively t
	  org-confirm-babel-evaluate nil
	  org-latex-pdf-process '("xelatex -interaction nonstopmode %f"
				  "xelatex -interaction nonstopmode %f")
	  org-babel-inline-result-wrap "%s"
	  org-latex-packages-alist '(((concat "a4paper,left=3cm,top=2cm,right=1.5cm,bottom=2cm,"
					      "marginparsep=7pt,marginparwidth=.6in") "geometry" t)
				     ("" "cmap" t)
				     ("" "xcolor" t)
				     ("" "listings" t)
				     ("" "polyglossia" t))))
#+END_SRC


* programming

** configurations (from variables)
#+BEGIN_SRC emacs-lisp
  (show-paren-mode local-confs/paren-mode)
#+END_SRC

** rainbow delimiters
#+BEGIN_SRC emacs-lisp
  (use-package rainbow-delimiters
    :ensure t
    :hook ((prog-mode org-mode) . rainbow-delimiters-mode))
#+END_SRC

** COMMENT flycheck
#+BEGIN_SRC emacs-lisp
  (use-package flycheck
    :ensure t :defer t
    :init (global-flycheck-mode))
#+END_SRC

** tree-sitter

Tree sitter is a cool integrate parser.

As mentioned in ~tree-sitter-load~ function description, reads binaries in format ~tree_sitter_$LANGNAME.so~ (and ~tree-sitter-$LANGNAME.so~) for linux.

All ~tree-sitter~ loads and requires are in language sprcified parts.

#+BEGIN_SRC emacs-lisp
  (use-package tree-sitter
    :ensure t
    :hook ((after-init . global-tree-sitter-mode)
	   ((sh-mode
	     c-mode c++mode rust-mode
	     java-mode python-mode
	     js2-mode json-mode html-mode) . tree-sitter-hl-mode))
    :config
    (add-to-list 'tree-sitter-load-path local-confs/tree-sitter-bins))

  (use-package tree-sitter-langs
    :ensure t
    :after tree-sitter)
#+END_SRC

** lsp

Base configuration of ~lsp~ client.

#+BEGIN_SRC emacs-lisp
  (use-package lsp-mode
    :ensure t
    :hook ((prog-mode . lsp)
	   (lsp-mode . lsp-enable-which-key-integration))
    :commands lsp)

  (use-package lsp-ui
    :ensure t
    :commands lsp-ui-mode)
#+END_SRC

*** helm

#+BEGIN_SRC emacs-lisp
  (use-package helm-lsp
    :ensure t
    :commands helm-lsp-workspace-symbol)
#+END_SRC

** company

Autocompletion with ~company~

*** company

#+BEGIN_SRC emacs-lisp
  (use-package company
    :ensure t
    :hook (after-init . global-company-mode))
#+END_SRC

*** company box

Backend for ~company~ with icons

#+BEGIN_SRC emacs-lisp
  (use-package company-box
    :ensure t
    :hook (company-mode . company-box-mode))
#+END_SRC

*** company-lsp

~company~ backend for ~lsp~ 

#+BEGIN_SRC emacs-lisp
  (use-package company-lsp
    :ensure t
    :after company-mode
    :config
    (add-to-list 'company-backends company-lsp))
#+END_SRC

** yasnippets

#+BEGIN_SRC emacs-lisp
  (use-package yasnippet
    :ensure t
    :hook ((prog-mode org-mode) . yas-minor-mode))

  (use-package yasnippet-snippets
    :ensure t
    :after yasnippet)
#+END_SRC

** langs

Specifiend customizations for programming related languages.

*** rust

Customization of Rust language.

#+BEGIN_SRC emacs-lisp
  (use-package rust-mode
    :ensure t
    :after tree-sitter
    :init
    (tree-sitter-load 'rust)
    (tree-sitter-require 'rust))
#+END_SRC

*** json
#+BEGIN_SRC emacs-lisp
  (use-package json-mode
    :ensure t :defer t)
#+END_SRC

** COMMENT debug
#+BEGIN_SRC emacs-lisp
  (use-package dap-mode
    :ensure t :defer t)
#+END_SRC


* scripts

Some useful scripts for any situations.

** sudo-reopen

Opens current file with ~sudo~ in a new buffer.

#+BEGIN_SRC emacs-lisp
  (defun sudo-reopen ()
    "Open curent file with sudo"
    (interactive)
    (find-file (concat "/sudo::" buffer-file-name)))
#+END_SRC

** tangle readme

Function for tangle (convert to ~init.el~) this file on save.

#+BEGIN_SRC emacs-lisp
  (defun tangle-file ()
    "Tangle file if name equals to `config-org-file`"
    (when (string= buffer-file-name
		   config-org-file)
      (org-babel-tangle-file buffer-file-name)))
  (add-hook 'after-save-hook 'tangle-file)
#+END_SRC


* COMMENT Empty src block
#+BEGIN_SRC emacs-lisp

#+END_SRC
